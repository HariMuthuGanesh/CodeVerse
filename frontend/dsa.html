<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 2: Time Stone - DSA Challenges</title>
    <link rel="stylesheet" href="../static/css/main.css">
    <style>
        .dsa-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 2rem;
        }

        /* HUD & Timer */
        .hud-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 1000px;
            margin-bottom: 2rem;
            padding: 1rem 2rem;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--accent-avengers);
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        .timer-display {
            font-size: 2rem;
            font-family: 'Orbitron', sans-serif;
            color: var(--accent-avengers);
            text-shadow: 0 0 10px var(--accent-avengers);
        }

        .timer-display.warning {
            color: var(--accent-red-bright);
            animation: pulse 1s infinite;
        }

        .score-display,
        .question-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--text-primary);
        }

        .challenge-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .challenge-tab {
            padding: 1rem 2rem;
            background: rgba(196, 30, 58, 0.1);
            border: 2px solid var(--accent-avengers);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .challenge-tab.active {
            background: rgba(196, 30, 58, 0.4);
            box-shadow: 0 0 20px var(--accent-avengers);
        }

        .challenge-content {
            display: none;
            width: 100%;
            max-width: 1000px;
            flex-direction: column;
            align-items: center;
        }

        .challenge-content.active {
            display: flex;
        }

        /* BST Game UI */
        .bst-viz-container {
            width: 100%;
            height: 500px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid var(--accent-avengers);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            padding-top: 40px;
        }

        /* Simple recursive tree CSS */
        .tree-node {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            margin: 0 10px;
        }

        .node-circle {
            width: 40px;
            height: 40px;
            background: var(--accent-avengers);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: white;
            z-index: 2;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            transition: all 0.3s;
            cursor: pointer;
        }

        .node-circle.highlight {
            background: #FFD700;
            /* Gold for search/active */
            color: black;
            transform: scale(1.2);
        }

        .node-connectors {
            display: flex;
            justify-content: center;
            width: 100%;
            position: relative;
            /* Lines drawn via SVG or pseudo-elements heavily simplified here */
        }

        .connector-line {
            /* Fallback or SVG logic needed. 
               For this implementation, we might just use simple margins */
        }

        .controls-area {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            width: 100%;
            justify-content: center;
        }

        .bst-controls {
            display: flex;
            gap: 1rem;
            background: rgba(0, 0, 0, 0.5);
            padding: 1rem;
            border-radius: 8px;
        }

        .btn-action {
            padding: 0.5rem 1.5rem;
            background: transparent;
            border: 1px solid var(--accent-avengers);
            color: var(--accent-avengers);
            font-family: 'Orbitron';
            cursor: pointer;
            transition: 0.2s;
        }

        .btn-action:hover {
            background: var(--accent-avengers);
            color: white;
        }

        /* Legacy Dropzones for RB */
        .bank-container {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border-bottom: 2px solid var(--accent-avengers);
            margin-bottom: 2rem;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .draggable {
            width: 50px;
            height: 50px;
            background: var(--accent-avengers);
            color: #fff;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 0 10px var(--accent-avengers);
            font-family: 'Orbitron';
        }

        .dropzone {
            width: 60px;
            height: 60px;
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
            background: rgba(0, 0, 0, 0.3);
        }

        /* Modals */
        #loading-overlay {
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--accent-avengers);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <div class="dsa-container">
        <!-- HUD PANEL -->
        <div class="hud-panel">
            <div class="score-display" id="score-display">BST Score: 0</div>
            <div class="timer-display" id="phase2-timer">10:00</div>
            <div>
                <button class="btn-action" onclick="leaveRound(false)"
                    style="border-color: #FFA500; color: #FFA500; margin-right: 1rem;">PAUSE & LEAVE</button>
                <button class="btn-action" onclick="finishRound()" style="border-color: #FF0000; color: #FF0000;">FINISH
                    ROUND</button>
            </div>
        </div>

        <h2 class="cinematic-title" style="color: var(--accent-avengers); margin-bottom: 0.5rem;">PHASE 2: TIME STONE
        </h2>
        <p style="color: grey; margin-bottom: 2rem;">Manage the Timeline. Pause to save time. Finish to lock score.</p>

        <div class="challenge-tabs">
            <button class="challenge-tab active" onclick="showChallenge('bst')" id="tab-bst">
                Binary Search Tree
            </button>
            <button class="challenge-tab" onclick="showChallenge('rb')" id="tab-rb">
                Red-Black Tree
            </button>
        </div>

        <!-- BST CHALLENGE UI -->
        <div id="challenge-bst" class="challenge-content active">
            <div style="background: rgba(0,0,0,0.5); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <h3>Hard BST Challenge</h3>
                <p>Construct a valid Binary Search Tree using ALL the numbers below. <br>
                    <span style="color: grey; font-size: 0.9em;">Rule: Left < Parent < Right. Deep violations are
                            checked!</span>
                </p>
            </div>

            <!-- Draggable Bank -->
            <div class="bank-container" id="bst-bank">
                <!-- Hardcoded values for the BST Challenge -->
                <div class="draggable" draggable="true" data-value="50"
                    style="background:var(--accent-avengers); color:white;">50</div>
                <div class="draggable" draggable="true" data-value="30"
                    style="background:var(--accent-avengers); color:white;">30</div>
                <div class="draggable" draggable="true" data-value="70"
                    style="background:var(--accent-avengers); color:white;">70</div>
                <div class="draggable" draggable="true" data-value="20"
                    style="background:var(--accent-avengers); color:white;">20</div>
                <div class="draggable" draggable="true" data-value="40"
                    style="background:var(--accent-avengers); color:white;">40</div>
                <div class="draggable" draggable="true" data-value="60"
                    style="background:var(--accent-avengers); color:white;">60</div>
                <div class="draggable" draggable="true" data-value="80"
                    style="background:var(--accent-avengers); color:white;">80</div>
            </div>

            <!-- Dropzone Tree Structure (Fixed Depth 3: Root, 2 Children, 4 Grandchildren) = 7 Slots Matches 7 Items -->
            <div style="display:flex; flex-direction:column; align-items:center; gap:2rem;">
                <!-- Level 1 -->
                <div class="dropzone" id="bst-slot-1" data-index="1"></div>

                <!-- Connector 1 -->
                <div style="width: 200px; height: 2px; background: rgba(255,255,255,0.2);"></div>

                <!-- Level 2 -->
                <div style="display:flex; gap:12rem;">
                    <div class="dropzone" id="bst-slot-2" data-index="2"></div>
                    <div class="dropzone" id="bst-slot-3" data-index="3"></div>
                </div>

                <!-- Connector 2 -->
                <div style="display:flex; gap:12rem;">
                    <div style="width: 100px; height: 2px; background: rgba(255,255,255,0.2);"></div>
                    <div style="width: 100px; height: 2px; background: rgba(255,255,255,0.2);"></div>
                </div>

                <!-- Level 3 -->
                <div style="display:flex; gap:4rem;">
                    <div class="dropzone" id="bst-slot-4" data-index="4"></div>
                    <div class="dropzone" id="bst-slot-5" data-index="5"></div>
                    <div style="width: 1px;"></div> <!-- Spacer -->
                    <div class="dropzone" id="bst-slot-6" data-index="6"></div>
                    <div class="dropzone" id="bst-slot-7" data-index="7"></div>
                </div>
            </div>

            <button class="btn-action" onclick="validateBST()" style="margin-top: 2rem;">VALIDATE BST</button>
        </div>

        <!-- RED-BLACK CHALLENGE UI (Legacy Support) -->
        <div id="challenge-rb" class="challenge-content">
            <div style="background: rgba(0,0,0,0.5); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                <h3>Red-Black Tree Challenge</h3>
                <p>Color the nodes and place them correctly. Root must be BLACK. No Red-Red relationships.</p>
            </div>

            <div class="bank-container" id="rb-bank">
                <!-- Nodes populated by JS -->
                <div class="draggable" draggable="true" data-value="10" data-color="black"
                    style="background:black; border:2px solid var(--accent-avengers);">10</div>
                <div class="draggable" draggable="true" data-value="5" data-color="red"
                    style="background:#D00; border:2px solid white;">5</div>
                <div class="draggable" draggable="true" data-value="15" data-color="red"
                    style="background:#D00; border:2px solid white;">15</div>
                <div class="draggable" draggable="true" data-value="2" data-color="black"
                    style="background:black; border:2px solid var(--accent-avengers);">2</div>
                <div class="draggable" draggable="true" data-value="7" data-color="black"
                    style="background:black; border:2px solid var(--accent-avengers);">7</div>
                <div class="draggable" draggable="true" data-value="12" data-color="black"
                    style="background:black; border:2px solid var(--accent-avengers);">12</div>
                <div class="draggable" draggable="true" data-value="20" data-color="black"
                    style="background:black; border:2px solid var(--accent-avengers);">20</div>
            </div>

            <!-- Hardcoded Tree Slots for RB -->
            <div style="display:flex; flex-direction:column; align-items:center; gap:2rem;">
                <div class="dropzone" id="rb-slot-1"></div>
                <div style="display:flex; gap:8rem;">
                    <div class="dropzone" id="rb-slot-2"></div>
                    <div class="dropzone" id="rb-slot-3"></div>
                </div>
                <div style="display:flex; gap:2rem;">
                    <div class="dropzone" id="rb-slot-4"></div>
                    <div class="dropzone" id="rb-slot-5"></div>
                    <div class="dropzone" id="rb-slot-6"></div>
                    <div class="dropzone" id="rb-slot-7"></div>
                </div>
            </div>

            <button class="btn-action" onclick="validateRB()" style="margin-top: 2rem;">VALIDATE RB TREE</button>
        </div>

    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal-overlay">
        <div class="glass-card" style="text-align:center; padding: 3rem; border-color: var(--accent-avengers);">
            <h2 id="result-title" class="cinematic-title"></h2>
            <p id="result-msg" style="margin: 2rem 0; font-size: 1.2rem;"></p>
            <div id="action-area"></div>
        </div>
    </div>

    <!-- Confirm Exit Modal -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="glass-card" style="text-align:center; padding: 3rem; border-color: var(--accent-red-bright);">
            <h2 class="cinematic-title" style="color:var(--accent-red-bright)">CONFIRM EXIT</h2>
            <p style="margin: 2rem 0; font-size: 1.2rem;">Are you sure you want to finish the round?</p>
            <p style="color: grey;">Your current score will be locked. You cannot return.</p>
            <div style="display:flex; gap:1rem; justify-content:center; margin-top:2rem;">
                <button class="btn-action" onclick="closeConfirm()"
                    style="border-color:white; color:white;">CANCEL</button>
                <button class="btn-action" onclick="confirmExit()"
                    style="background:var(--accent-red-bright); color:black; font-weight:bold;">CONFIRM FINISH</button>
            </div>
        </div>
    </div>

    <script src="../static/js/cursor.js"></script>
    <script src="../static/js/state-manager.js"></script>
    <script src="../static/js/dsa-trees.js"></script>
    <script src="../static/js/dsa.js"></script>
</body>

</html>